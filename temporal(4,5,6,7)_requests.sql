USE MachinesServiceTemporal;
GO

--Вывести состояние всех таблиц базы данных по состоянию на последний день 
--каждого квартала 2022 года в 23:59:59.9999999.

--первый квартал
SELECT *
FROM Machines FOR SYSTEM_TIME AS OF '2022-03-31 23:59:59.9999999'

SELECT *
FROM RepairType FOR SYSTEM_TIME AS OF '2022-03-31 23:59:59.9999999'

SELECT *
FROM Repair FOR SYSTEM_TIME AS OF '2022-03-31 23:59:59.9999999'

SELECT *
FROM MachineRepairs FOR SYSTEM_TIME AS OF '2022-03-31 23:59:59.9999999'

--второй квартал
SELECT *
FROM Machines FOR SYSTEM_TIME AS OF '2022-06-30 23:59:59.9999999'

SELECT *
FROM RepairType FOR SYSTEM_TIME AS OF '2022-06-30 23:59:59.9999999'

SELECT *
FROM Repair FOR SYSTEM_TIME AS OF '2022-06-30 23:59:59.9999999'

SELECT *
FROM MachineRepairs FOR SYSTEM_TIME AS OF '2022-06-30 23:59:59.9999999'

--третий квартал
SELECT *
FROM Machines FOR SYSTEM_TIME AS OF '2022-09-30 23:59:59.9999999'

SELECT *
FROM RepairType FOR SYSTEM_TIME AS OF '2022-09-30 23:59:59.9999999'

SELECT *
FROM Repair FOR SYSTEM_TIME AS OF '2022-09-30 23:59:59.9999999'

SELECT *
FROM MachineRepairs FOR SYSTEM_TIME AS OF '2022-09-30 23:59:59.9999999'

--четвёртый квартал
SELECT *
FROM Machines FOR SYSTEM_TIME AS OF '2022-12-31 23:59:59.9999999'

SELECT *
FROM RepairType FOR SYSTEM_TIME AS OF '2022-12-31 23:59:59.9999999'

SELECT *
FROM Repair FOR SYSTEM_TIME AS OF '2022-12-31 23:59:59.9999999'

SELECT *
FROM MachineRepairs FOR SYSTEM_TIME AS OF '2022-12-31 23:59:59.9999999'


-- Вывести состояние всех таблиц базы данных за лето 2022 года.
--лето 2022 года
SELECT *
FROM Machines FOR SYSTEM_TIME
BETWEEN '2022-06-01 00:00:00.0000000' AND '2022-08-31 23:59:59.9999999'

SELECT *
FROM RepairType FOR SYSTEM_TIME
BETWEEN '2022-06-01 00:00:00.0000000' AND '2022-08-31 23:59:59.9999999'

SELECT *
FROM Repair FOR SYSTEM_TIME
BETWEEN '2022-06-01 00:00:00.0000000' AND '2022-08-31 23:59:59.9999999'

SELECT *
FROM MachineRepairs FOR SYSTEM_TIME
BETWEEN '2022-06-01 00:00:00.0000000' AND '2022-08-31 23:59:59.9999999'

--Вывести строки, которые были вставлены и удалены за третий квартал 2022 года.
SELECT *
FROM Machines FOR SYSTEM_TIME CONTAINED IN ('2022-03-01','2022-09-30 23:59:59.9999999');

SELECT *
FROM Repair FOR SYSTEM_TIME CONTAINED IN ('2022-03-01','2022-09-30 23:59:59.9999999');

SELECT *
FROM RepairType FOR SYSTEM_TIME CONTAINED IN ('2022-03-01','2022-09-30 23:59:59.9999999');

SELECT *
FROM MachineRepairs FOR SYSTEM_TIME CONTAINED IN ('2022-03-01','2022-09-30 23:59:59.9999999');

--Создать любой запрос с несколькими темпоральными таблицами, используя JOIN.

--Запрос извлекает информацию о коде станков, их марках и типе, а также о цене ремонта 
--в конкретный момент времени.
SELECT M.MachineCode, M.Mark, R.MachineType, RT.Price
FROM Machines FOR SYSTEM_TIME AS OF '2022-03-01 00:00:00.0000000' AS M
JOIN Repair FOR SYSTEM_TIME AS OF '2022-03-01 00:00:00.0000000' AS R
ON M.MachineCode = R.MachineCode
JOIN RepairType FOR SYSTEM_TIME AS OF '2022-03-01 00:00:00.0000000' AS RT
ON R.TypeCode = RT.TypeCode
ORDER BY M.MachineCode;
